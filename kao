<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>スカイライナー Eチケット予約</title>
    <script src="https://cdn.jsdelivr.net/npm/aws-sdk@2.7.0/dist/aws-sdk.min.js"></script>
</head>
<body>
    <h1>スカイライナー Eチケット予約</h1>
    <form id="ticketForm">
        <label for="date">乗車日:</label>
        <input type="date" id="date" required><br><br>

        <label for="type">券種:</label>
        <select id="type" required>
            <option value="oneway">片道</option>
            <option value="roundtrip">往復</option>
        </select><br><br>

        <label for="from">乗車駅:</label>
        <input type="text" id="from" required><br><br>

        <label for="to">下車駅:</label>
        <input type="text" id="to" required><br><br>

        <label for="passengers">人数:</label>
        <input type="number" id="passengers" min="1" required><br><br>

        <button type="submit">予約する</button>
    </form>

    <div id="faceRegistration" style="display:none;">
        <h2>顔認証登録</h2>
        <video id="video" width="640" height="480" autoplay></video>
        <button id="capture">撮影</button>
        <canvas id="canvas" width="640" height="480" style="display:none;"></canvas>
    </div>

    <script>
        document.getElementById('ticketForm').addEventListener('submit', function(e) {
            e.preventDefault();
            // ここで予約処理を行う
            document.getElementById('faceRegistration').style.display = 'block';
        });

        // 顔認証の処理
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const captureButton = document.getElementById('capture');

        navigator.mediaDevices.getUserMedia({ video: true })
            .then(stream => video.srcObject = stream)
            .catch(console.error);

        captureButton.addEventListener('click', function() {
            canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);
            const imageData = canvas.toDataURL('image/jpeg');

            // AWSの設定（実際の使用時は適切な認証情報を使用してください）
            AWS.config.update({
                region: 'ap-northeast-1',
                credentials: new AWS.CognitoIdentityCredentials({
                    IdentityPoolId: 'YOUR_IDENTITY_POOL_ID'
                })
            });

            const rekognition = new AWS.Rekognition();
            const params = {
                Image: {
                    Bytes: atob(imageData.split(',')[1])
                },
                CollectionId: 'skyliners'
            };

            rekognition.indexFaces(params, function(err, data) {
                if (err) console.log(err, err.stack);
                else {
                    console.log('Face indexed:', data);
                    // ここで顔認証サーバーにデータを送信
                }
            });
        });
    </script>
</body>
</html>
